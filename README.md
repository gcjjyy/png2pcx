# PNG2PCX 변환 도구 모음

PNG와 PCX 이미지 형식 간의 양방향 변환을 지원하는 TypeScript 기반 이미지 형식 변환 툴킷입니다. 256색 팔레트 기반 색상 매핑 및 시각화 도구를 제공합니다.

## 개요

이 패키지는 256색 팔레트를 지원하는 PNG와 PCX 형식 간의 양방향 변환 기능을 제공합니다. 레트로 게임 개발, DOS 그래픽 작업 또는 특정 색상 팔레트를 사용하는 PCX 형식 이미지가 필요한 모든 상황에 유용합니다.

## 주요 기능

- 커스텀 팔레트 매핑을 통한 **PNG → PCX 변환**
- 투명도를 지원하는 **PCX → PNG 변환**
- 색상 팔레트 검사를 위한 **팔레트 시각화** 도구
- PCX 파일을 위한 RLE (Run-Length Encoding) 압축
- 팔레트 기반 변환을 위한 자동 근사 색상 매칭
- 여러 파일 일괄 처리

## 설치

```bash
# 의존성 설치
npm install
```

### 의존성
- `pngjs` - PNG 이미지 조작
- `typescript`, `ts-node` - TypeScript 실행
- Node.js 내장 모듈 (`fs`, `path`)

## 도구 설명

### 1. png2pcx.ts - PNG → PCX 변환기

지정된 256색 팔레트 파일을 사용하여 PNG 이미지를 PCX 형식으로 변환합니다.

**기능:**
- `DMTD.PAL` 파일에서 팔레트 읽기 (768바이트 - 256색 × RGB 3바이트)
- 가장 가까운 팔레트 색상으로 매핑 (투명도를 위한 인덱스 0 제외)
- 알파 채널 처리 (알파 ≤ 128인 픽셀은 투명하게 처리)
- 대문자 이름으로 PCX 파일 출력

**사용법:**
```bash
ts-node png2pcx.ts
```

**요구사항:**
- 현재 디렉토리에 `DMTD.PAL` 파일이 있어야 함
- 변환할 PNG 파일들이 현재 디렉토리에 있어야 함

### 2. pcx2png.ts - PCX → PNG 변환기

PCX 이미지를 완전한 투명도 지원과 함께 PNG 형식으로 다시 변환합니다.

**기능:**
- RLE 압축된 PCX 데이터 디코딩
- PCX 파일에 내장된 256색 팔레트 읽기
- 팔레트 인덱스 0을 투명 픽셀로 매핑
- 소문자 이름으로 PNG 파일 출력

**사용법:**
```bash
ts-node pcx2png.ts
```

**요구사항:**
- 변환할 PCX 파일들이 현재 디렉토리에 있어야 함

### 3. pal2png.ts - 팔레트 시각화 도구

768바이트 RGB 팔레트 파일을 PNG 이미지로 시각화합니다.

**기능:**
- 각 팔레트 색상을 격자의 픽셀로 렌더링
- 사용자 정의 가능한 격자 레이아웃 (기본값 16×16)
- 다양한 열 구성 지원

**사용법:**
```bash
# 기본 16×16 레이아웃
ts-node pal2png.ts --input palette.pal --output palette.png

# 32열 레이아웃 (32×8)
ts-node pal2png.ts --input palette.pal --output palette.png --cols 32

# 단일 행 스트립 (256×1)
ts-node pal2png.ts --input palette.pal --output palette.png --cols 256
```

**매개변수:**
- `-i, --input` : 입력 팔레트 파일 경로 (필수)
- `-o, --output` : 출력 PNG 파일 경로 (필수)
- `--cols` : 출력 격자의 열 개수 (선택, 기본값: 16)

## 파일 형식

### PCX 형식 세부사항
- **헤더**: 이미지 크기 및 인코딩 정보를 포함한 128바이트
- **이미지 데이터**: RLE 압축된 픽셀 데이터
- **팔레트**: 파일 끝의 769바이트 (0x0C 마커 + 768 RGB 바이트)
- **픽셀당 비트**: 8 (256색)
- **인코딩**: RLE 압축 (런렝스 인코딩된 바이트에 0xC0 접두사)

### 팔레트 파일 형식
- **크기**: 768바이트 (256색 × 색상당 3바이트)
- **구조**: 연속된 RGB 삼중항
- **순서**: 각 색상 인덱스(0-255)에 대한 R, G, B 값

## 사용 예제

### PNG를 PCX로 일괄 변환
```bash
# 현재 디렉토리에 DMTD.PAL 파일 배치
# 현재 디렉토리에 PNG 파일들 배치
ts-node png2pcx.ts
# 출력: 대문자 이름의 .PCX 파일 생성
```

### PCX를 PNG로 일괄 변환
```bash
# 현재 디렉토리에 PCX 파일들 배치
ts-node pcx2png.ts
# 출력: 소문자 이름의 .png 파일 생성
```

### 팔레트 시각화
```bash
# 팔레트 색상의 시각적 격자 생성
ts-node pal2png.ts --input DMTD.PAL --output dmtd_palette.png
```

## 오류 처리

모든 도구는 일반적인 문제에 대한 오류 처리를 포함합니다:
- 누락되거나 잘못된 팔레트 파일
- 잘못된 파일 형식
- RLE 디코딩 오류
- 파일 I/O 오류

개별 파일 변환 오류는 기록되지만 일괄 처리를 중단하지 않습니다.

## 기술적 세부사항

### 투명도 처리
- **PNG → PCX**: 알파 채널 ≤ 128은 팔레트 인덱스 0으로 매핑
- **PCX → PNG**: 팔레트 인덱스 0은 완전히 투명하게 변환 (알파 = 0)

### 색상 매칭 알고리즘
PNG에서 PCX 변환기는 RGB 색상 공간에서 유클리드 거리를 사용하여 가장 가까운 팔레트 색상을 찾습니다:
```
거리 = (r1-r2)² + (g1-g2)² + (b1-b2)²
```

### RLE 압축
PCX 파일은 다음과 같은 런렝스 인코딩을 사용합니다:
- 상위 비트가 설정된 바이트(0xC0-0xFF)는 런을 나타냄
- 하위 6비트는 런 카운트 지정 (1-63)
- 다음 바이트는 반복할 값
